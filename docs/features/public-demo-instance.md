# Public Demo Instance — Interactive Showcase Without Personal Data

> **Status:** Planned (Phase 8.9)
> **Estimated effort:** 4-5 days
> **Depends on:** Phase 8.8 (configurable categories — demo should use generic categories)
> **Ongoing cost:** ~$10-15/month

## Problem

SecondBrain is a compelling portfolio project, but there's no way to show it to others without exposing personal vault data (tasks, notes, relationships, financial info). Screenshots are static and don't convey the interactive experience — the chat, task management, capture flow, and morning briefing.

## Solution

Deploy a public demo instance with a sample vault containing realistic but fictional data. Auto-deploy on every push to main so the demo always reflects the latest code. Rate-limit LLM calls to cap costs.

### Architecture

```
GitHub (push to main)
  → GitHub Actions (build Docker image)
    → Fly.io (deploy single machine)
      ├── Backend: FastAPI/uvicorn (port 8000)
      ├── Frontend: Next.js production build (port 7860)
      ├── Sample vault: baked into container at /vault
      ├── Data dir: persistent volume at /data (SQLite + ChromaDB)
      └── LLM: Anthropic Haiku via API key (rate-limited)
```

### Work Item 1: Sample vault

**Goal:** A realistic Obsidian vault with fictional data that demonstrates all SecondBrain features.

**Behavior:**
- Create `demo/vault/` in the repo with the standard folder structure:
  - `00_Daily/` — 10-14 daily notes spanning 2 weeks, with tasks, events, focus items
  - `10_Notes/` — 8-10 notes (recipes, travel plans, meeting notes, research)
  - `20_Projects/` — 2-3 project files (a side project, a work initiative)
  - `30_Concepts/` — 3-4 concept files (technical topics, personal reference)
  - `90_Meta/Templates/` — daily note template
  - `Tasks/` — generated by task aggregator (not committed — generated at build time)
  - `Inbox/` — empty (captures happen at runtime)
- Fictional persona: "Alex Chen" — a software engineer with a side project (a recipe app), work tasks at a company called "Meridian Tech", personal tasks, and a mix of daily notes.
- Tasks span categories "Work" (with sub-project "Recipe App" and "Platform Migration") and "Personal" (with subcategories matching the defaults: Family, Health, Errands, Projects, General).
- Include a few overdue tasks, tasks due today, and future tasks to demonstrate the urgency sorting.
- Include 2-3 wiki links between notes to demonstrate link-aware retrieval (if Phase 9 is done).
- All content is clearly fictional — no real names, companies, or sensitive data.

**Files:** `demo/vault/` (new directory tree)

### Work Item 2: Dockerfile

**Goal:** Containerize both backend and frontend in a single image.

**Behavior:**
- Multi-stage Dockerfile:
  - **Stage 1 (frontend build):** Node.js 20, install deps, `npm run build`. Use demo branding (`APP_NAME = "SecondBrain Demo"`, `USER_NAME = "Alex"`, `USER_INITIAL = "A"`) — either via build args or a demo config.ts.
  - **Stage 2 (backend):** Python 3.12, install `uv`, `uv sync`, copy source.
  - **Stage 3 (runtime):** Slim Python base, copy built frontend + backend + demo vault. Entrypoint: a `start.sh` script that runs initial indexing (if data volume is empty), then starts uvicorn + next in parallel.
- The sample vault is copied into the image at `/vault`.
- The data directory (`/data`) is a Fly.io persistent volume — survives redeployments but can be recreated from scratch via reindexing.
- Environment variables for API keys are injected via Fly.io secrets (not baked into image).
- Frontend `next.config.ts` proxy destination stays as `127.0.0.1:8000` (both processes in same container).
- CORS origins updated to include the Fly.io app URL.

**Files:** `Dockerfile` (new), `demo/start.sh` (new), `demo/config.ts` (demo branding override), `.dockerignore` (new)

### Work Item 3: Rate limiting middleware

**Goal:** Prevent abuse and cap LLM costs on the public demo.

**Behavior:**
- Add a simple in-memory rate limiter middleware to FastAPI for the demo deployment only (gated by `SECONDBRAIN_DEMO_MODE=true` env var).
- Limits:
  - `/api/v1/ask/stream`: 10 requests per IP per hour (the expensive LLM endpoint)
  - `/api/v1/capture`: 5 requests per IP per hour (writes to vault)
  - All other endpoints: 60 requests per IP per minute (generous for browsing)
- Returns HTTP 429 with a friendly message: "Demo rate limit reached. Try again in X minutes."
- When `DEMO_MODE` is not set, the middleware is a no-op (no impact on the real installation).
- Monthly budget cap: set Anthropic API key spending limit to $10/month on the Anthropic dashboard. If exhausted, the `/ask` endpoint returns a graceful error instead of crashing.

**Files:** `src/secondbrain/middleware/rate_limit.py` (new), `src/secondbrain/main.py` (register middleware), `src/secondbrain/config.py` (add `demo_mode` setting)

### Work Item 4: GitHub Actions deploy pipeline

**Goal:** Auto-deploy to Fly.io on every push to main.

**Behavior:**
- Add a deploy workflow `.github/workflows/deploy-demo.yml`:
  1. Triggered on push to `main` (after CI passes)
  2. Builds Docker image
  3. Pushes to Fly.io registry
  4. Deploys to Fly.io app
- Fly.io app configuration (`fly.toml`):
  - Machine: `shared-cpu-2x` with 2GB RAM (needed for sentence-transformers model)
  - Persistent volume: 1GB for `/data`
  - Internal port: 7860 (frontend serves, proxies to backend)
  - Health check: `GET /api/v1/health`
  - Auto-stop: enabled (machine stops when idle, starts on request — saves cost)
- Secrets managed via `fly secrets set`:
  - `SECONDBRAIN_ANTHROPIC_API_KEY`
  - `SECONDBRAIN_DEMO_MODE=true`

**Files:** `.github/workflows/deploy-demo.yml` (new), `fly.toml` (new)

### Work Item 5: README demo link and badge

**Goal:** Visitors to the GitHub repo can immediately try the demo.

**Behavior:**
- Add a "Live Demo" badge and link at the top of README.md
- Brief description: "Try SecondBrain with sample data — no setup required"
- Link to the Fly.io app URL
- Note that it uses fictional data and LLM calls are rate-limited

**Files:** `README.md`

## Implementation Order

1. WI1 (sample vault) — no dependencies, can start immediately
2. WI2 (Dockerfile) — can start in parallel with WI1
3. WI3 (rate limiting) — independent
4. WI4 (CI/CD pipeline) — depends on WI2
5. WI5 (README) — depends on WI4 (need the URL)

WI1, WI2, and WI3 can all be done in parallel.

## What's Explicitly Out of Scope

| Excluded | Rationale |
|----------|-----------|
| Authentication/login on the demo | Over-engineering. Rate limiting is sufficient for a showcase demo. If abuse becomes a problem, add Cloudflare Access later. |
| Read-only demo mode | The capture and task editing features are part of the showcase. Rate limiting prevents abuse. |
| Separate staging environment | One demo instance is enough. The real installation runs on the Mac Studio via Tailscale. |
| Custom domain | `secondbrain-demo.fly.dev` is fine for now. Custom domain can be added later for $0. |
| Docker Compose for local dev | The existing `make dev` workflow works for local development. Docker is for the demo deployment only. |
| Vault data persistence across deploys | The demo vault is baked into the image. SQLite/ChromaDB data is on a persistent volume but can be recreated via reindexing. Conversations created by demo visitors don't need to persist. |

## Risk Assessment

| Risk | Impact | Mitigation |
|------|--------|------------|
| LLM costs spiral from heavy usage | Medium — could hit $50+/month | Rate limiting (10 asks/hour/IP) + Anthropic dashboard spending cap ($10/month) + Fly.io auto-stop |
| Demo goes down | Low — it's a showcase, not production | Fly.io health checks + auto-restart. If it's down, visitors see a "demo unavailable" message. |
| Someone abuses the capture endpoint to fill disk | Low | Rate limit (5 captures/hour/IP) + Fly.io volume size cap (1GB). Periodic cleanup of demo captures via cron. |
| sentence-transformers model download is slow on first boot | Medium — 420MB download delays first deploy | Pre-download model in Dockerfile build stage. Bake it into the image. |
| Personal data leaks into demo vault | Critical | Demo vault is committed to repo as a separate directory (`demo/vault/`), completely independent of the real vault. The real vault path is never configured in demo mode. |

## Cost Estimate

| Component | Monthly Cost |
|-----------|-------------|
| Fly.io `shared-cpu-2x` 2GB RAM (with auto-stop) | $5-7 |
| Fly.io 1GB persistent volume | $0.15 |
| Anthropic API (Haiku, rate-limited) | $1-5 |
| **Total** | **~$7-13/month** |

With auto-stop enabled, the machine only runs when someone is actively using the demo. At low traffic, costs will be at the lower end.

## Testing

**Automated:**
- CI should build the Docker image successfully (add to existing CI workflow)
- Rate limiter unit tests: verify limits are enforced, verify no-op when demo_mode is off
- Sample vault should pass `make reindex` without errors

**Manual QA:**
- Deploy to Fly.io → verify all pages load
- Chat with the demo → verify answers reference sample vault content
- Capture a note → verify it appears (and rate limit kicks in after 5)
- Verify personal vault data is NOT present anywhere in the demo
- Verify auto-stop works (machine stops after idle, restarts on next request)

## Design Decisions

| Decision | Rationale |
|----------|-----------|
| Single container (backend + frontend) | Simplest deployment. Two containers add orchestration complexity for no benefit at this scale. |
| Fly.io over Railway/Render | Best auto-stop support (saves cost when idle), good CLI tooling, persistent volumes, reasonable pricing |
| Rate limiting per IP, not per session | Simplest. Session-based requires auth/cookies. IP-based is sufficient for a demo. |
| Sample vault in `demo/vault/`, not generated | Hand-crafted content is more realistic and showcases features better than generated data. |
| Auto-stop enabled | The demo will have very low traffic. Paying for 24/7 uptime when nobody is using it wastes money. Cold start adds ~10-15 seconds but that's acceptable for a demo. |
| Demo branding ("SecondBrain Demo" / "Alex") not the user's branding | The whole point is to show this is a general-purpose tool, not a personal one. |
